(function(n){n.widget("ui.tagit",{options:{allowDuplicates:!1,caseSensitive:!0,fieldName:"tags",placeholderText:null,readOnly:!1,removeConfirmation:!1,tagLimit:null,availableTags:[],autocomplete:{},showAutocompleteOnFocus:!1,allowSpaces:!1,singleField:!1,singleFieldDelimiter:",",singleFieldNode:null,animate:!0,tabIndex:null,beforeTagAdded:null,afterTagAdded:null,beforeTagRemoved:null,afterTagRemoved:null,onTagClicked:null,onTagLimitExceeded:null,onTagAdded:null,onTagRemoved:null,tagSource:null},_create:function(){var t=this,r,u,f,i;this.element.is("input")?(this.tagList=n("<ul><\/ul>").insertAfter(this.element),this.options.singleField=!0,this.options.singleFieldNode=this.element,this.element.css("display","none")):this.tagList=this.element.find("ul, ol").andSelf().last();this.tagInput=n('<input type="text" />').addClass("ui-widget-content");this.options.readOnly&&this.tagInput.attr("disabled","disabled");this.options.tabIndex&&this.tagInput.attr("tabindex",this.options.tabIndex);this.options.placeholderText&&this.tagInput.attr("placeholder",this.options.placeholderText);this.options.autocomplete.source||(this.options.autocomplete.source=function(t,i){var r=t.term.toLowerCase(),u=n.grep(this.options.availableTags,function(n){return n.toLowerCase().indexOf(r)===0});i(this._subtractArray(u,this.assignedTags()))});this.options.showAutocompleteOnFocus&&(this.tagInput.focus(function(){t._showAutocomplete()}),typeof this.options.autocomplete.minLength=="undefined"&&(this.options.autocomplete.minLength=0));n.isFunction(this.options.autocomplete.source)&&(this.options.autocomplete.source=n.proxy(this.options.autocomplete.source,this));n.isFunction(this.options.tagSource)&&(this.options.tagSource=n.proxy(this.options.tagSource,this));this.tagList.addClass("tagit").addClass("ui-widget ui-widget-content ui-corner-all").append(n('<li class="tagit-new"><\/li>').append(this.tagInput)).click(function(i){var u=n(i.target),r;u.hasClass("tagit-label")?(r=u.closest(".tagit-choice"),r.hasClass("removed")||t._trigger("onTagClicked",i,{tag:r,tagLabel:t.tagLabel(r)})):t.tagInput.focus()});r=!1;this.options.singleField&&(this.options.singleFieldNode?(u=n(this.options.singleFieldNode),f=u.val().split(this.options.singleFieldDelimiter),u.val(""),n.each(f,function(n,i){t.createTag(i,null,!0);r=!0})):(this.options.singleFieldNode=n('<input type="hidden" style="display:none;" value="" name="'+this.options.fieldName+'" />'),this.tagList.after(this.options.singleFieldNode)));r||this.tagList.children("li").each(function(){n(this).hasClass("tagit-new")||(t.createTag(n(this).text(),n(this).attr("class"),!0),n(this).remove())});this.tagInput.keydown(function(i){if(i.which==n.ui.keyCode.BACKSPACE&&t.tagInput.val()===""){var r=t._lastTag();!t.options.removeConfirmation||r.hasClass("remove")?t.removeTag(r):t.options.removeConfirmation&&r.addClass("remove ui-state-highlight")}else t.options.removeConfirmation&&t._lastTag().removeClass("remove ui-state-highlight");(i.which===n.ui.keyCode.COMMA||i.which===n.ui.keyCode.ENTER||i.which==n.ui.keyCode.TAB&&t.tagInput.val()!==""||i.which==n.ui.keyCode.SPACE&&t.options.allowSpaces!==!0&&(n.trim(t.tagInput.val()).replace(/^s*/,"").charAt(0)!='"'||n.trim(t.tagInput.val()).charAt(0)=='"'&&n.trim(t.tagInput.val()).charAt(n.trim(t.tagInput.val()).length-1)=='"'&&n.trim(t.tagInput.val()).length-1!=0))&&(i.which===n.ui.keyCode.ENTER&&t.tagInput.val()===""||i.preventDefault(),t.createTag(t._cleanedInput()),t.tagInput.autocomplete("close"))}).blur(function(){t.tagInput.data("autocomplete-open")||t.createTag(t._cleanedInput())});(this.options.availableTags||this.options.tagSource||this.options.autocomplete.source)&&(i={select:function(n,i){return t.createTag(i.item.value),!1},focus:function(n,i){n.preventDefault();t.tagInput.val(i.item.label)}},n.extend(i,this.options.autocomplete),i.source=this.options.tagSource||i.source,this.tagInput.autocomplete(i).bind("autocompleteopen",function(){t.tagInput.data("autocomplete-open",!0)}).bind("autocompleteclose",function(){t.tagInput.data("autocomplete-open",!1)}))},_cleanedInput:function(){return n.trim(this.tagInput.val().replace(/^"(.*)"$/,"$1"))},_lastTag:function(){return this.tagList.find(".tagit-choice:last:not(.removed)")},_tags:function(){return this.tagList.find(".tagit-choice:not(.removed)")},assignedTags:function(){var i=this,t=[];return this.options.singleField?(t=n(this.options.singleFieldNode).val().split(this.options.singleFieldDelimiter),t[0]===""&&(t=[])):this._tags().each(function(){t.push(i.tagLabel(this))}),t},_updateSingleTagsField:function(t){n(this.options.singleFieldNode).val(t.join(this.options.singleFieldDelimiter)).trigger("change")},_subtractArray:function(t,i){for(var u=[],r=0;r<t.length;r++)n.inArray(t[r],i)==-1&&u.push(t[r]);return u},tagLabel:function(t){return this.options.singleField?n(t).find(".tagit-label:first").text():n(t).find("input:first").val()},_showAutocomplete:function(){this.tagInput.autocomplete("search","")},_findTagByLabel:function(t){var i=this,r=null;return this._tags().each(function(){if(i._formatStr(t)==i._formatStr(i.tagLabel(this)))return r=n(this),!1}),r},_isNew:function(n){return!this._findTagByLabel(n)},_formatStr:function(t){return this.options.caseSensitive?t:n.trim(t.toLowerCase())},_effectExists:function(t){return Boolean(n.effects&&(n.effects[t]||n.effects.effect&&n.effects.effect[t]))},createTag:function(t,i,r){var s=this,f,e,u,h,c,l,o;if(t=n.trim(t),this.options.preprocessTag&&(t=this.options.preprocessTag(t)),t==="")return!1;if(!this.options.allowDuplicates&&!this._isNew(t))return f=this._findTagByLabel(t),this._trigger("onTagExists",null,{existingTag:f,duringInitialization:r})!==!1&&this._effectExists("highlight")&&f.effect("highlight"),!1;if(this.options.tagLimit&&this._tags().length>=this.options.tagLimit)return this._trigger("onTagLimitExceeded",null,{duringInitialization:r}),!1;(e=n(this.options.onTagClicked?'<a class="tagit-label"><\/a>':'<span class="tagit-label"><\/span>').text(t),u=n("<li><\/li>").addClass("tagit-choice ui-widget-content ui-state-default ui-corner-all").addClass(i).append(e),this.options.readOnly?u.addClass("tagit-choice-read-only"):(u.addClass("tagit-choice-editable"),h=n("<span><\/span>").addClass("ui-icon ui-icon-close"),c=n('<a><span class="text-icon">×<\/span><\/a>').addClass("tagit-close").append(h).click(function(){s.removeTag(u)}),u.append(c)),this.options.singleField||(l=e.html(),u.append('<input type="hidden" style="display:none;" value="'+l+'" name="'+this.options.fieldName+'" />')),this._trigger("beforeTagAdded",null,{tag:u,tagLabel:this.tagLabel(u),duringInitialization:r})!==!1)&&(this.options.singleField&&(o=this.assignedTags(),o.push(t),this._updateSingleTagsField(o)),this._trigger("onTagAdded",null,u),this.tagInput.val(""),this.tagInput.parent().before(u),this._trigger("afterTagAdded",null,{tag:u,tagLabel:this.tagLabel(u),duringInitialization:r}),this.options.showAutocompleteOnFocus&&!r&&setTimeout(function(){s._showAutocomplete()},0))},removeTag:function(t,i){var r,e,u,f;(i=typeof i=="undefined"?this.options.animate:i,t=n(t),this._trigger("onTagRemoved",null,t),this._trigger("beforeTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})!==!1)&&(this.options.singleField&&(r=this.assignedTags(),e=this.tagLabel(t),r=n.grep(r,function(n){return n!=e}),this._updateSingleTagsField(r)),i?(t.addClass("removed"),u=this._effectExists("blind")?["blind",{direction:"horizontal"},"fast"]:["fast"],f=this,u.push(function(){t.remove();f._trigger("afterTagRemoved",null,{tag:t,tagLabel:f.tagLabel(t)})}),t.fadeOut("fast").hide.apply(t,u).dequeue()):(t.remove(),this._trigger("afterTagRemoved",null,{tag:t,tagLabel:this.tagLabel(t)})))},removeTagByLabel:function(n,t){var i=this._findTagByLabel(n);if(!i)throw"No such tag exists with the name '"+n+"'";this.removeTag(i,t)},removeAll:function(){var n=this;this._tags().each(function(t,i){n.removeTag(i,!1)})}})})(jQuery);
//# sourceMappingURL=tag-it.min.js.map
